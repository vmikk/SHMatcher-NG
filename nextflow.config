

// Global default params, used in configs
includeConfig 'conf/params.config'

// Process configuration
process {

    // Lin-cluster query sequences
    withName: 'precluster'{
        cpus = 8
    }

    // MMseqs global search (queries vs SH database)
    withName: 'mmseqs_search'{
        cpus = 8
    }

    // Cluster membership preparation
    withName: 'prepare_cluster_keys'{
        cpus = 8
    }

    // Prepare FASTA files for each (compound) cluster
    withName: 'cluster_extract'{
        cpus = 8
    }


    // Minimap2 global search (queries vs reference database)
    withName: 'minmap2_search'{
        cpus = 8
    }


    // Generate a distance matrix
    withName: 'calc_distmx'{
        cpus = 2
    }

    // Agglomerative clustering of a distance matrix
    withName: 'cluster_aggd'{
        cpus = 2
    }
}


profiles {

    // Docker-based profile
    docker {
        docker.enabled         = true
        conda.enabled          = false
        singularity.enabled    = false
        podman.enabled         = false
        shifter.enabled        = false
        charliecloud.enabled   = false
        apptainer.enabled      = false
        docker.runOptions      = '-u $(id -u):$(id -g)'

        // Container specifications are here
        includeConfig 'conf/docker.config'
    }

}

// Reports (trace file, timeline, etc.)
timeline {
    enabled = true
}
report {
    enabled = true
}
trace {
    enabled = true
}
dag {
    enabled = false
}

